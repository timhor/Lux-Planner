<br>
<stop-info #stop>
  <div class="stop-info-header">
    <button type="button" id="stopModalCloseButton" class="btn btn-danger pull-right" (click)="stop.hide()"><i class="fa fa-times" aria-hidden="true"></i></button>
  </div>
  <div class="stop-info-body">
  </div>
  <div class="stop-info-footer">
  </div>
</stop-info>
<app-itinerary #itinerary>
  <div class="app-itinerary-header">
    <button type="button" class="btn btn-danger pull-right" (click)="itinerary.hide()"><i class="fa fa-times" aria-hidden="true"></i></button>
  </div>
  <div class="app-itinerary-body">
  </div>
  <div class="app-itinerary-footer">
  </div>
</app-itinerary>
<app-confirm #confirm>
  <div class="app-confirm-header">
    <button type="button" class="btn btn-danger pull-right" (click)="confirm.hide()"><i class="fa fa-times" aria-hidden="true"></i></button>
    Confirm
  </div>
  <div class="app-confirm-body">
    <p>Are you sure you want to delete your notes?</p>
    <br>
  </div>
  <div class="app-confirm-footer">
    <button type="button" class="button-rect button-orange" id="modal-button-left" (click)="confirm.hide()">Cancel</button>
    <button type="button" class="button-rect button-red" id="modal-button" (click)="deleteNotes()" (click)="confirm.hide()">Confirm</button>
  </div>
</app-confirm>
<div class="container">
  <div class="row">
    <div class="col-sm-12" style="width:calc(100% - 1%);">
      <div id="progressBar" class="well" *ngIf="isLoading">
          <h3>Loading...</h3>
          <div class="progress">
            <div class="indeterminate"></div>
          </div>
      </div>
      <div class="well" *ngIf="!isLoading">
        <div class="dropdown">
          <button class="btn dropdown-toggle" type="button" data-toggle="dropdown"  id="currentJourneyHeader" *ngIf="getJourneyLength() !== 1">
            <p id="subHeading">{{ journeyName }}&nbsp;<span class="fa fa-caret-down"></span></p>
          </button>
          <button class="btn dropdown-toggle" type="button" id="singleJourneyHeader" *ngIf="getJourneyLength() === 1">
            <p id="subHeading">{{ journeyName }}&nbsp;</p>
          </button>
          <ul class="dropdown-menu">
            <li id="dropdownItem" *ngFor="let journey of allJourneys; let i=index" (click)="setActiveJourney(journey.journey_name)">
              {{ journey.journey_name }}
            </li>
          </ul>
        </div>
        <div align="center">
            <h1 id="currentJourney" align="center" *ngIf="activeStopIndex !== -1">{{ shortStop(stops[activeStopIndex].name) }}&nbsp;&nbsp;</h1>
            <h1 id="currentJourney" align="center" *ngIf="activeStopIndex === -1">Overview&nbsp;&nbsp;</h1>
            <br>
          <!-- <div class="dropdown">
            <button class="btn dropdown-toggle" type="button" data-toggle="dropdown" id="currentJourneyHeader">
              <h1 id="currentJourney" align="center" *ngIf="activeStopIndex !== -1">{{ shortStop(stops[activeStopIndex].name) }}&nbsp;&nbsp;
                <span class="fa fa-caret-down" *ngIf="getJourneyLength() !== 1"></span>
              </h1>
              <h1 id="currentJourney" align="center" *ngIf="activeStopIndex === -1">Overview&nbsp;&nbsp;
                <span class="fa fa-caret-down" *ngIf="getJourneyLength() !== 1"></span>
              </h1>
            </button>
            <ul class="dropdown-menu" *ngIf="getJourneyLength() !== 1">
              <li id="dropdownItem" routerLink="/dashboard" (click)="resetFirstLoad()">
                <h4>Overview</h4>
              </li>
              <li id="dropdownItem" *ngFor="let stop of stops" (click)="setActiveStop(stop.name)">
                <h4>{{ shortStop(stop.name) }}</h4>
              </li>
            </ul>
          </div> -->
        </div>

        <div class="btn-group btn-block" id="timeline-buttons"> 
          <span class="line"></span>
          <button class="btn-circle-start" (click)="resetFirstLoad()" [tooltip]="convertDate(allJourneys[activeJourneyIndex].start)" tooltipPlacement="top"><i class="fa fa-home" aria-hidden="true"></i><label class="start-label">{{shortStop(startingLocationName)}}</label></button>
          <span *ngFor="let stop of stops; let i=index;">
            <button class="btn-circle" (click)="setActiveStop(stop.name)" [tooltip]="convertDate(stop.arrival) + ', ' + getDuration(stop.departure,stop.arrival) + ' days'" tooltipPlacement="top">
              {{i+1}}<label class="stop-label">{{shortStop(stop.name)}}</label>
            </button>
          </span>
          <button class="btn-circle-start" (click)="resetFirstLoad()" [tooltip]="convertDate(allJourneys[activeJourneyIndex].end)" tooltipPlacement="top"><i class="fa fa-home" aria-hidden="true"></i><label class="start-label">{{shortStop(startingLocationName)}}</label></button>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-3" *ngIf="activeStopIndex!==-1">
      <div class ="well" *ngIf="!isLoading">
        <h4 id="journeyOverview" align="center" (click)="resetFirstLoad()"><span class="fa fa-caret-left"></span>&nbsp; Journey Overview</h4>
      </div>
      <div class="well" align="center" *ngIf="!isLoading">
        <p id="subHeading">Itinerary</p>
        <div class="row" *ngFor="let stop of stops; let i=index;" align="center" style="padding-left:0.5vw;">
          <div class="btn-group" align="center">
            <button type="button" class="btn btn-default btn-md truncate stopButton" *ngIf="i!==activeStopIndex" (click)="setActiveStop(stop.name)" align="center"><span>{{shortStop(stop.name)}}</span></button>
            <button type="button" class="btn btn-default btn-md truncate active stopButton" *ngIf="i===activeStopIndex" align="center"><span>{{shortStop(stop.name)}}</span></button>
            <button type="button" class="btn btn-default btn-md itineraryButton" (click)="itinerary.show(getStop(i))" align="center"><i class="fa fa-map" aria-hidden="true"></i></button>
          </div>
        </div>
      </div>
      <div class="well" id="aboutWell" *ngIf="!isLoading">
        <p id="subHeading">About</p>
        <p [innerHtml]="shortAbout()"></p>
        <button type="button" class="button-rect button-blue pull-right" (click)="stop.show(getCurrStop())" id="findOutMoreBtn">Find Out More</button>
        <br><br>
      </div>
      <div class="well" *ngIf="!isLoading">
        <p id="subHeading">Calendar</p>
        <iframe src="https://calendar.google.com/calendar/embed?showTitle=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;height=600&amp;wkst=1&amp;bgcolor=%23ffffff&amp;src=irjrjrntp2vjb11uoduhgl0ubg%40group.calendar.google.com&amp;color=%23AB8B00&amp;ctz=Australia%2FSydney"
          style="border:solid 1px #777" width="100%" height="250" frameborder="0" scrolling="no"></iframe>
      </div>
    </div>
    <div class="col-sm-3" *ngIf="activeStopIndex===-1">
      <div class="well" *ngIf="!isLoading">
        <p id="subHeading">Search for Flights</p>
        <iframe id="widgetIframe" src="https://www.expedia.com/marketing/widgets/searchform/widget?wtt=1&tp1=1234&tp2=&lob=F&des=&sfs=5&wbi=13&olc=000000&whf=1&hfc=C7C7C7&wif=2&ifc=C7C7C7&wbc=FFCB00&wbf=1&bfc=3D3100&wws=2" 
          width="100%" height="450px" scrolling="no" frameborder="0"></iframe>
      </div>
    </div>
    <div class="col-sm-9">
      <div class="col-sm-12" *ngIf="activeStopIndex!==-1">
        <div class="well" *ngIf="!isLoading">
            <p id="subHeading">{{stops[activeStopIndex].name}} Map</p>
            <agm-map [latitude]="stops[activeStopIndex].lat" [longitude]="stops[activeStopIndex].lng" [zoom]="10" [disableDoubleClickZoom]="false" [scrollwheel]="false">
            <agm-marker [latitude]="stops[activeStopIndex].lat" [longitude]="stops[activeStopIndex].lng"></agm-marker>
          </agm-map>
        </div>
        <div class="well" *ngIf="!isLoading">
          <!-- <div id="weather-forecast" *ngFor="let i of stops">
            <iframe id="weatherapp" *ngIf="i==stops[activeStopIndex]" width="100%" height="245" frameborder="0" style="border:0" [src]='sanitizer.bypassSecurityTrustResourceUrl("https://forecast.io/embed/#lat=" + i.lat + "&lon=" + i.lng + "&name=" + i.name + "&units=uk&color=#000037")'
              allowfullscreen></iframe>
          </div> -->
          <p id="subHeading">{{stops[activeStopIndex].name}} Weather Forecast</p>          
          <div id="weatherHolder">
              <weather-widget [settings]="settings"></weather-widget>              
          </div>
        </div>
        <div class="well" *ngIf="!isLoading">
          <p id="subHeading">Notes</p>
          <div class="notesArea">
            <p *ngIf="stops[activeStopIndex].notes !== null && !isModifyingNotes" id="notesText">{{stops[activeStopIndex].notes}}</p>
            <p *ngIf="stops[activeStopIndex].notes === null && !isModifyingNotes" id="notesTextEmpty">No existing notes found.</p>
            <textarea *ngIf="isModifyingNotes" class="form-control" rows="10" [(ngModel)]="newNotes" id="textArea"></textarea>
          </div>
          <br>
          <div class="btn-group">
            <button *ngIf="stops[activeStopIndex].notes === null && !isModifyingNotes" type="button" class="button-rect button-blue pull-right" (click)="modifyNotes()">Add Notes</button>
            <button *ngIf="stops[activeStopIndex].notes !== null && !isModifyingNotes" type="button" class="button-rect button-blue pull-right" (click)="modifyNotes()">Modify Notes</button>
          </div>
          <div class="btn-group" *ngIf="isModifyingNotes" id="notesBtns" align="right">
            <button type="button" class="button-rect button-red" *ngIf="stops[activeStopIndex].notes !== null" id="notesDeleteBtn" (click)="confirm.show()">Delete</button>
            <button type="button" class="button-rect button-orange" id="notesCancelBtn" (click)="cancelNotes()">Cancel</button>
            <button type="button" class="button-rect button-green" (click)="saveNotes()">Save</button>
          </div>
        </div>
      </div>
      <div class="col-sm-12" *ngIf="activeStopIndex===-1">
        <div class="well" *ngIf="!isLoading">
          <!-- <iframe width="100%" height="450" frameborder="0" style="border:0" [src]='sanitizer.bypassSecurityTrustResourceUrl(mapUrl)'
            allowfullscreen></iframe> -->
            <p id="subHeading">Journey Map</p>
            <agm-map [fitBounds]="bounds" [disableDoubleClickZoom]="false" [scrollwheel]="false">
              <agm-marker iconUrl="../assets/Marker.png" [latitude]="allJourneys[activeJourneyIndex].lat" [longitude]="allJourneys[activeJourneyIndex].lng"></agm-marker>                                
              <agm-marker *ngFor="let stop of stops; let i=index" [label]="(i+1).toString()" [latitude]="stop.lat" [longitude]="stop.lng"></agm-marker>
              <agm-polyline *ngFor="let stop of stops; let i=index" [geodesic]="true" [strokeWeight]="2">            
                <agm-polyline-point *ngIf="i!==(stops.length-1)" [latitude]="stops[i].lat" [longitude]="stops[i].lng"></agm-polyline-point>
                <agm-polyline-point *ngIf="i!==(stops.length-1)" [latitude]="stops[i+1].lat" [longitude]="stops[i+1].lng"></agm-polyline-point>
              </agm-polyline>
              <agm-polyline [geodesic]="true" [strokeWeight]="2">            
                <agm-polyline-point [latitude]="allJourneys[activeJourneyIndex].lat" [longitude]="allJourneys[activeJourneyIndex].lng"></agm-polyline-point>
                <agm-polyline-point [latitude]="stops[0].lat" [longitude]="stops[0].lng"></agm-polyline-point>
              </agm-polyline> 
              <agm-polyline [geodesic]="true" [strokeWeight]="2">            
                <agm-polyline-point [latitude]="stops[stops.length-1].lat" [longitude]="stops[stops.length-1].lng"></agm-polyline-point>
                <agm-polyline-point [latitude]="allJourneys[activeJourneyIndex].lat" [longitude]="allJourneys[activeJourneyIndex].lng"></agm-polyline-point>
              </agm-polyline> 
            </agm-map>
        </div>
      </div>
    </div>
  </div>
</div>